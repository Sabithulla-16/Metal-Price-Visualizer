<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MetalPrice Live - Real-time Precious Metals Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Real-time precious metals and cryptocurrency prices for India market">
  <meta name="theme-color" content="#0b1020">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="./manifest.json">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect fill='%230b1020' width='192' height='192'/><circle cx='96' cy='96' r='70' fill='%2322c55e'/><text x='96' y='120' font-size='80' font-weight='bold' text-anchor='middle' fill='%23000' font-family='Arial'>‚Çπ</text></svg>">
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'><rect fill='%230b1020' width='180' height='180' rx='40'/><circle cx='90' cy='90' r='65' fill='%2322c55e'/><text x='90' y='115' font-size='75' font-weight='bold' text-anchor='middle' fill='%23000' font-family='Arial'>‚Çπ</text></svg>">

  <!-- Preconnect to APIs and CDNs -->
  <link rel="preconnect" href="https://api.gold-api.com" crossorigin>
  <link rel="preconnect" href="https://api.frankfurter.app" crossorigin>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>

  <!-- Preload and link external stylesheet -->
  <link rel="preload" href="./style.css" as="style" onload="this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="./style.css"></noscript>

  <!-- Load libraries from CDN (deferred) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
</head>
<body>

    <div class="offline-overlay" id="offlineOverlay">
      <div class="offline-icon">üì°</div>
      <div class="offline-text">
        <h2>You're Offline</h2>
        <p>Showing cached prices from your last online session</p>
        <div class="offline-data"><div id="offlineLastUpdate">Last updated: checking...</div></div>
      </div>
    </div>

    <div class="online-notification" id="onlineNotification">
      <h2>üéâ Back Online!</h2>
      <p>Refreshing live prices...</p>
    </div>

    <div class="status-notification" id="statusNotification">
      <div class="status-dot"></div>
      <span id="statusText">Online</span>
    </div>

    <div class="loading-overlay" id="loadingOverlay">
      <div class="loader-container">
        <div class="premium-loader"></div>
        <div class="loader-text">Fetching Live Prices...</div>
      </div>
    </div>

    <div class="container">

      <header>
        <div>
          <h1>METALPRICE LIVE</h1>
          <p>Real-time Precious Metals Price Tracker</p>
        </div>
        <div class="header-actions">
          <button id="installBtn" class="hidden">Install App</button>
        </div>
      </header>

      <div class="datetime" id="datetime">‚Äî</div>

      <div class="selector-group">
        <span class="selector-title">Asset</span>
        <div class="pills" id="assetPills">
          <button class="active" onclick="selectAsset(this,'XAU','Gold','metal')">Gold</button>
          <button onclick="selectAsset(this,'XAG','Silver','metal')">Silver</button>
          <button onclick="selectAsset(this,'XPT','Platinum','metal')">Platinum</button>
          <button onclick="selectAsset(this,'XPD','Palladium','metal')">Palladium</button>
          <button onclick="selectAsset(this,'HG','Copper','metal')">Copper</button>
          <button onclick="selectAsset(this,'BTC','Bitcoin','crypto')">Bitcoin</button>
          <button onclick="selectAsset(this,'ETH','Ethereum','crypto')">Ethereum</button>
        </div>
      </div>

      <div class="selector-group" id="modeGroup" style="display:none;">
        <span class="selector-title">Type</span>
        <div class="pills" id="modeToggle">
          <button class="active" onclick="setMode(this,'india')">India Market</button>
          <button onclick="setMode(this,'spot')">Spot Price</button>
        </div>
      </div>

      <div class="selector-group" id="weightGroup" style="display:none;">
        <span class="selector-title">Weight</span>
        <div class="pills" id="weightToggle"></div>
      </div>

      <div class="main-grid">
        <div class="price-card">
          <div class="asset" id="assetName">Gold</div>
          <div class="price-display">
            <div class="price" id="price">‚Çπ --</div>
            <div class="delta" id="delta"></div>
          </div>

          <div class="purity-grid gold-only" id="puritySection">
            <div class="purity-item"><div class="label">24K</div><div class="value" id="k24">--</div></div>
            <div class="purity-item"><div class="label">22K</div><div class="value" id="k22">--</div></div>
            <div class="purity-item"><div class="label">18K</div><div class="value" id="k18">--</div></div>
          </div>
        </div>

        <div class="price-card">
          <div class="stats-grid">
            <div class="stat-box"><div class="stat-label" id="usdLabel">Price (1g in USD)</div><div class="stat-value" id="usdPrice">--</div></div>
            <div class="stat-box"><div class="stat-label" id="inrLabel">Price (1g in INR)</div><div class="stat-value" id="inrPrice">--</div></div>
          </div>

          <div style="margin-top:20px;padding:16px;border-top:1px solid rgba(255,215,0,0.2);background:rgba(0,0,0,0.3);border-radius:8px;">
            <div style="font-size:11px;color:var(--muted);margin-bottom:8px;text-transform:uppercase;font-weight:700;letter-spacing:0.5px;">Status</div>
            <div style="font-size:15px;font-weight:800;display:flex;align-items:center;gap:8px;"><span id="statusIndicator" style="color:var(--success);">‚óè Live - Online</span></div>
            <div id="lastUpdateTime" style="font-size:10px;color:var(--muted);margin-top:6px;font-weight:500;">Updated just now</div>
          </div>
        </div>
      </div>

      <div class="charts-section">
        <div class="charts-title">Price History</div>
        <div class="charts">
          <div class="chart-box"><div class="chart-title">Daily Trend</div><canvas id="dailyChart"></canvas></div>
          <div class="chart-box"><div class="chart-title">Comparison</div><canvas id="monthlyChart"></canvas></div>
        </div>
      </div>

      <div class="export-section">
        <button class="btn-primary" onclick="exportToPDF()">Export PDF</button>
        <button class="btn-secondary" onclick="copyToClipboard()">Copy</button>
      </div>

  </div>

  <!-- External script (all logic here) -->
  <script src="./script.js" defer></script>
</body>
</html>